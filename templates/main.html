<html>
  <head>
    <title>Anamorphing projection</title>
    <link rel="shortcut icon" type="image/png" href="/static/images/logo.png"/>
    <link rel="stylesheet" href="/static//css/mono.css">
    <link rel="stylesheet" href="/static//css/mono-glitch.css">
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>-->
    <link href='https://fonts.googleapis.com/css?family=Varela' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <img src="/static/images/logo.png" id="static" width="90px" style="float: left;" />
    <div id="welcome"><div class="glitch" data-text="Welcome to {{project}} project">Welcome to {{project}} project</div></div>
    <div class="toolbar">
      <div class="copyright">Copyright (c) Vladimir Hlukhau, 2022</div>
{%for project in projects%}
      <button class="button" style="vertical-align:middle" onclick="loadContent('{{project.name}}')" type="button"><span>{{project.name}} </span></button>
{%endfor%}
      <button class="button" style="vertical-align:middle" onclick="/" type="button"><span>+ </span></button>
      <div id="content">

      </div>
    </div>
  </body>

    <script>

function loadContent(project) {
    var param = {"project": project};
    console.log("project: " + project)

    $.ajax({
      type: "POST",
      url: "/content",
      data: JSON.stringify(param),
      contentType: "application/json",
      success: function(result) {
        console.log("Result:");
        console.log(result);

        var div = document.getElementById('content');
        div.innerHTML = result;
        div = document.getElementById('welcome');
        div.innerHTML = '<div class="glitch" data-text="Welcome to ' + project + ' project">Welcome to ' + project + ' project</div>';
      }
    });
}

function upload(file, path) {
  console.log(file, path);
  var url = '/send?path=' + path;
  var xhr = new XMLHttpRequest()
  var formData = new FormData()
  xhr.open('POST', url, true)
  xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
  formData.append('file', file)
  xhr.send(formData)
  xhr.addEventListener('readystatechange', function(e) {
    if (xhr.readyState == 4 && xhr.status == 200) {
      loadContent()
    }
  })
}

function perform(url) {
  var xhr = new XMLHttpRequest()
  xhr.open('GET', url, true)
  xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
  xhr.send()

  xhr.addEventListener('readystatechange', function(e) {
    if (xhr.readyState == 4 && xhr.status == 200) {
      loadContent()
    }
  })
}

loadContent('demo')
    </script>
</html>